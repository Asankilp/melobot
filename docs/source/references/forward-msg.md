# 转发消息与消息结点

在前一篇文章 [消息内容的数据结构](./msg) 中我们说明了 OneBot 标准是如何表示**单条 qq 消息中**可能存在的多种类型的内容的（如文本、语音或图片），主要是通过 **CQ 字符串**或**消息段数组**的形式。

但是如果是转发消息这种包含**多条消息**的消息，要如何表示呢？这个时候就需要消息结点了。

在 melobot 中，你不需要手动构造消息结点的数据结构，构造方法参考：{func}`.custom_msg_node` 和 {func}`.refer_msg_node`（不用马上跳转，看完本篇文章再去看更好哦）。**虽然无需手动构造，但是了解转发消息的数据结构，有助于你设计实现更复杂的功能**。


```{admonition} 提示
:class: tip
在 OneBot 标准和其他一些文档中，习惯说“消息节点”，这与本文档中的“消息结点”完全是同一概念。
```

```{admonition} 相关知识
:class: note
在 melobot 中，涉及转发消息发送的“行为操作函数”主要有：{func}`.send_forward`, {func}`.send_custom_forward`。阅读以下内容后，你会对这些函数的使用方法有更清晰的理解。
```

在 OneBot 标准中，转发消息中的单条消息，需要用一个“消息结点”表示。而消息结点的数组，自然也就可以表示转发消息中的“多条消息”。消息结点主要分为两种：

- 合并转发结点（转发现有的一条消息，需要消息 ID 定位“已经存在的这条消息”）
- 合并转发自定义结点（这条消息之前完全不存在，直接自定义出来的）

## 合并转发结点

两种格式的表示方法：

```json
{
    "type": "node",
    "data": {
        "id": "123456"
    }
}
```

```
[CQ:node,id=123456]
```

| 参数名 | 收 | 发 | 可能的值 | 说明 |
| --- | --- | --- | --- | --- |
| `id` |  | ✓ | - | 转发的消息 ID |

消息 ID 在 melobot 中可通过消息事件的 {attr}`~.MessageEvent.id` 属性获得，或通过行为操作函数 {func}`.get_forward_msg` 的响应获得。

## 合并转发自定义结点

例子 1：

```json
{
    "type": "node",
    "data": {
        "user_id": "10001000",
        "nickname": "某人",
        "content": "[CQ:face,id=123]哈喽～"
    }
}
```

```
[CQ:node,user_id=10001000,nickname=某人,content=&#91;CQ:face&#44;id=123&#93;哈喽～]
```

例子 2：

```json
{
    "type": "node",
    "data": {
        "user_id": "10001000",
        "nickname": "某人",
        "content": [
            {"type": "face", "data": {"id": "123"}},
            {"type": "text", "data": {"text": "哈喽～"}}
        ]
    }
}
```

| 参数名 | 收 | 发 | 可能的值 | 说明 |
| --- | --- | --- | --- | --- |
| `user_id` | ✓ | ✓ | - | 发送者 QQ 号 |
| `nickname` | ✓ | ✓ | - | 发送者昵称 |
| `content` | ✓ | ✓ | - | 消息内容，即上一章所述的[单条消息内容](./msg) |
